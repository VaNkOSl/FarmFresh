@model List<FarmerOrderListViewModel>

@{
	ViewData["Title"] = "Farmer Order List";
}

<h2 class="text-center my-4">Order List</h2>

@if (Model == null || !Model.Any())
{
	<div class="alert alert-warning text-center" role="alert">
		<strong>No orders found.</strong>
	</div>
}
else
{
	var groupedOrders = Model.GroupBy(order => order.OrderId);

	foreach (var orderGroup in groupedOrders)
	{
		<div class="border rounded p-3 mb-4 shadow-sm">
			<h4>Order ID: @orderGroup.Key</h4>
			<div class="table-responsive">
				<table class="table table-hover align-middle shadow-sm">
					<thead class="table-primary">
						<tr>
							<th>Product Name</th>
							<th>Price</th>
							<th>Quantity</th>
							<th>Total</th>
							<th>Photo</th>
							<th>Details</th>
						</tr>
					</thead>
					<tbody>
						@foreach (var product in orderGroup)
						{
							<tr>
								<td>@product.ProductName</td>
								<td>@product.Price.ToString("C")</td>
								<td>@product.Quantity</td>
								<td>@(product.Price * product.Quantity)</td>
								<td>
									@if (product.Photos != null)
									{
										<img src="@product.Photos.FilePath" class="img-thumbnail" style="max-width: 100px; max-height: 100px;" alt="Product Photo" />
									}
									else
									{
										<img src="https://via.placeholder.com/100" class="img-thumbnail" alt="No Product Photo" />
									}
								</td>
								<td>
									<a asp-action="Details" asp-route-id="@product.Id" class="btn btn-outline-primary btn-sm">
										<i class="bi bi-eye"></i> View Details
									</a>
								</td>
							</tr>
						}
					</tbody>
				</table>
			</div>
			<div class="text-end">
				<div class="card-footer text-center">
					<form method="post" asp-action="SendOrder" asp-controller="Order" asp-route-id="@orderGroup.Key" class="d-inline">
						<button type="submit" class="btn btn-success me-2">
							<i class="bi bi-send"></i> Send Order
						</button>
					</form>

					<form method="post" asp-action="CancelOrder" asp-controller="Order" asp-route-id="@orderGroup.Key" class="d-inline">
						<button type="submit" class="btn btn-danger" onclick="return confirm('Please note that you must inform the user why you are canceling the order.')">
							<i class="bi bi-x-circle"></i> Cancel Order
						</button>
					</form>
				</div>
			</div>

		</div>
	}
}